name: DEV build

on:
    push:
        branches: ["develop"]

jobs:
    build-and-deploy:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v2

            - name: Deploy to server second method
              uses: appleboy/ssh-action@master
              with:
                  host: ${{ secrets.SERVER_IP }}
                  port: ${{ secrets.SERVER_PORT }}
                  username: ${{ secrets.SSH_USERNAME }}
                  password: ${{ secrets.SSH_PASSWORD }}
                  script: |
                      cd ${{ secrets.PATH_TO_APP_DEV }}
                      echo $(pwd) > /root/log.log 
                      git pull |& tee -a /root/log.log
                      cp .env.dev .env |& tee -a /root/log.log
                      echo "HCAPTCHA_SITE_KEY='${{ secrets.HCAPTCHA_SITE_KEY }}'" >> .env |& tee -a /root/log.log
                      echo "HCAPTCHA_SECRET=${{secrets.HCAPTCHA_SECRET}}" >> .env |& tee -a /root/log.log
                      docker compose down |& tee -a /root/log.log
                      docker compose up --build -d |& tee -a /root/log.log
                      docker ps |& tee -a /root/log.log
                      echo $(date) >> /root/log.log
